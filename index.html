
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lector de Medidores Gemini</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-purple-50 text-gray-800">
  <div class="max-w-3xl mx-auto py-10 px-6">
    <h1 class="text-3xl font-bold text-purple-700 mb-8">Lector de Medidores Gemini</h1>

    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-semibold text-purple-600 mb-4">Paso 1: Sube o Captura Fotos del Medidor</h2>
      <input type="file" id="imageInput" multiple class="mb-4 border p-2 rounded"/>
      <div id="preview" class="border p-2 rounded bg-gray-50"></div>
    </div>

    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-xl font-semibold text-purple-600 mb-4">Paso 2: Generar Informe con Gemini</h2>
      <button onclick="generateReport()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Generar Informe</button>
    </div>

    <div class="bg-white p-6 rounded shadow">
      <h2 class="text-xl font-semibold text-purple-600 mb-4">Informe Generado</h2>
      <div id="output" class="text-sm whitespace-pre-line bg-gray-100 p-4 rounded border border-gray-300"></div>
    </div>
  </div>

  <script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');

    imageInput.addEventListener('change', () => {
      preview.innerHTML = '';
      [...imageInput.files].forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'h-40 inline-block mr-2 mb-2';
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    async function generateReport() {
      const files = imageInput.files;
      if (!files.length) return alert("Sube al menos una imagen");

      const formData = new FormData();
      for (const file of files) {
        formData.append("files", file);
      }

      const responseBox = document.getElementById("output");
      responseBox.innerHTML = "Procesando...";

      try {
        const res = await fetch("https://lector-yaye.onrender.com/api/gemini-report", {
          method: "POST",
          body: formData,
        });

        const result = await res.json();
        const { filename, size_kb, message } = result;

        responseBox.innerHTML = `
          <p><strong>Archivo:</strong> ${filename}</p>
          <p><strong>Tama√±o:</strong> ${size_kb} KB</p>
          <div class="mt-2 p-2 bg-white rounded text-sm leading-relaxed whitespace-pre-line border border-gray-300">
            ${message.replace(/\n/g, "<br>")}
          </div>
        `;
      } catch (error) {
        responseBox.innerHTML = "<span class='text-red-500'>Error al generar el informe.</span>";
      }
    }
  </script>
</body>
</html>
