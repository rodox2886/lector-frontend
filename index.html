<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Lector de Medidores Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-purple-50 text-gray-800 p-6">
    <h1 class="text-3xl font-bold text-center text-purple-700 mb-8">Lector de Medidores Gemini</h1>

    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
        <h2 class="text-xl font-semibold text-purple-700 mb-2">Paso 1: Sube o Captura Fotos del Medidor</h2>
        <input type="file" id="imageInput" accept="image/*" class="mb-2">
        <div id="preview" class="mt-4"></div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
        <h2 class="text-xl font-semibold text-purple-700 mb-2">Paso 2: Generar Informe con Gemini</h2>
        <button id="generateBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Generar Informe</button>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-md">
        <h2 class="text-xl font-semibold text-purple-700 mb-2">Informe Generado</h2>
        <pre id="result" class="bg-gray-100 p-4 rounded overflow-auto text-sm text-red-700"></pre>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const generateBtn = document.getElementById('generateBtn');
        const result = document.getElementById('result');
        const preview = document.getElementById('preview');

        imageInput.addEventListener('change', () => {
            preview.innerHTML = '';
            const file = imageInput.files[0];
            if (file) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                img.className = "w-32 mt-2 rounded border";
                preview.appendChild(img);
            }
        });

        generateBtn.addEventListener('click', async () => {
            const file = imageInput.files[0];
            if (!file) {
                result.textContent = "Por favor selecciona una imagen.";
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            try {
                const response = await fetch("https://lector-yaye.onrender.com/api/gemini-report", {
                    method: "POST",
                    body: formData
                });

                const data = await response.json();
                if (!response.ok) {
                    throw data;
                }
                result.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                result.textContent = "Â¡Error! " + JSON.stringify(error, null, 2);
            }
        });
    </script>
</body>
</html>
